<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizaci√≥n del Grafo de Pel√≠culas - Neo4j</title>
    <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            margin: 0;
            color: #333;
            font-size: 24px;
            font-weight: 600;
        }

        .header p {
            margin: 5px 0 0 0;
            color: #666;
            font-size: 14px;
        }

        #cy {
            flex: 1;
            background: #f8f9fa;
        }

        .controls {
            margin-bottom: 20px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .control-group input, .control-group select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .control-group input:focus, .control-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.4);
        }

        .info-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .info-panel h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .info-item .label {
            font-weight: 600;
            color: #666;
        }

        .info-item .value {
            color: #333;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }

        .legend {
            margin-top: 20px;
        }

        .legend h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            border: 2px solid #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .movie-color {
            background: #ff6b6b;
        }

        .person-color {
            background: #4ecdc4;
        }

        .movie-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .movie-checkbox:hover {
            background-color: #f8f9fa;
        }

        .movie-checkbox input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.1);
        }

        .movie-checkbox label {
            cursor: pointer;
            font-size: 13px;
            color: #333;
            flex: 1;
        }

        .movie-checkbox input[type="checkbox"]:checked + label {
            font-weight: 600;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="controls">
                <div class="control-group">
                    <label for="layout-select">Layout:</label>
                    <select id="layout-select">
                        <option value="cose">Cose (Autom√°tico)</option>
                        <option value="circle">C√≠rculo</option>
                        <option value="grid">Grid</option>
                        <option value="breadthfirst">Breadth First</option>
                        <option value="concentric">Conc√©ntrico</option>
                        <option value="random">Aleatorio</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="start-node">Nodo de inicio (DFS/BFS):</label>
                    <input type="text" id="start-node" placeholder="Ingresa el nombre del nodo">
                </div>

                <div class="control-group">
                    <label for="end-node">Nodo final (Camino m√°s corto):</label>
                    <input type="text" id="end-node" placeholder="Ingresa el nombre del nodo">
                </div>

                <button class="btn" onclick="loadGraph()">Cargar Grafo</button>
                <button class="btn btn-secondary" onclick="performDFS()">Ejecutar DFS</button>
                <button class="btn btn-secondary" onclick="performBFS()">Ejecutar BFS</button>
                <button class="btn btn-secondary" onclick="findShortestPath()">Camino M√°s Corto</button>
                <button class="btn btn-secondary" onclick="resetGraph()">Resetear</button>
                
                <hr style="margin: 20px 0; border: none; border-top: 1px solid #e1e5e9;">
                
                <div class="control-group">
                    <label for="new-actor-name">Agregar Nuevo Actor:</label>
                    <input type="text" id="new-actor-name" placeholder="Nombre del actor">
                </div>
                
                <div class="control-group">
                    <label for="movie-selection">Pel√≠culas donde actu√≥:</label>
                    <div id="movie-selection" style="max-height: 150px; overflow-y: auto; border: 2px solid #e1e5e9; border-radius: 6px; padding: 10px; background: #fff;">
                        <div style="text-align: center; color: #666; font-style: italic;">Cargando pel√≠culas...</div>
                    </div>
                </div>
                
                <button class="btn" onclick="addNewActor()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">‚ûï Agregar Actor</button>
                
                <hr style="margin: 20px 0; border: none; border-top: 1px solid #e1e5e9;">
                
                <div class="control-group">
                    <label for="new-movie-title">Agregar Nueva Pel√≠cula:</label>
                    <input type="text" id="new-movie-title" placeholder="T√≠tulo de la pel√≠cula">
                </div>
                
                <div class="control-group">
                    <label for="actor-selection">Actores:</label>
                    <div id="actor-selection" style="max-height: 120px; overflow-y: auto; border: 2px solid #e1e5e9; border-radius: 6px; padding: 10px; background: #fff;">
                        <div style="text-align: center; color: #666; font-style: italic;">Cargando actores...</div>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="director-selection">Directores:</label>
                    <div id="director-selection" style="max-height: 120px; overflow-y: auto; border: 2px solid #e1e5e9; border-radius: 6px; padding: 10px; background: #fff;">
                        <div style="text-align: center; color: #666; font-style: italic;">Cargando directores...</div>
                    </div>
                </div>
                
                <button class="btn" onclick="addNewMovie()" style="background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);">üé¨ Agregar Pel√≠cula</button>
            </div>

            <div class="info-panel">
                <h3>Informaci√≥n del Grafo</h3>
                <div class="info-item">
                    <span class="label">Nodos:</span>
                    <span class="value" id="node-count">-</span>
                </div>
                <div class="info-item">
                    <span class="label">Aristas:</span>
                    <span class="value" id="edge-count">-</span>
                </div>
                <div class="info-item">
                    <span class="label">Estado:</span>
                    <span class="value" id="graph-status">Cargando...</span>
                </div>
            </div>

            <div class="legend">
                <h4>Leyenda</h4>
                <div class="legend-item">
                    <div class="legend-color movie-color"></div>
                    <span>Pel√≠culas</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color person-color"></div>
                    <span>Personas</span>
                </div>
            </div>

            <div id="results-panel" style="margin-top: 20px;"></div>
        </div>

        <div class="main-content">
            <div class="header">
                <h1>üé¨ Visualizaci√≥n del Grafo de Pel√≠culas</h1>
                <p>Explora las relaciones entre pel√≠culas, actores y directores usando algoritmos de grafos</p>
            </div>
            <div id="cy"></div>
        </div>
    </div>

    <script>
        let cy;
        let graphData = null;
        let highlightedNodes = new Set();
        let highlightedEdges = new Set();

        // Inicializar Cytoscape
        function initCytoscape() {
            try {
                cy = cytoscape({
                    container: document.getElementById('cy'),
                    elements: [],
                    style: [
                        {
                            selector: 'node',
                            style: {
                                'background-color': function(ele) {
                                    return ele.data('type') === 'MOVIE' ? '#ff6b6b' : '#4ecdc4';
                                },
                                'label': 'data(label)',
                                'text-valign': 'center',
                                'text-halign': 'center',
                                'color': '#fff',
                                'text-outline-width': 2,
                                'text-outline-color': '#000',
                                'font-size': '12px',
                                'font-weight': 'bold',
                                'width': function(ele) {
                                    return ele.data('type') === 'MOVIE' ? '60px' : '50px';
                                },
                                'height': function(ele) {
                                    return ele.data('type') === 'MOVIE' ? '60px' : '50px';
                                },
                                'border-width': 2,
                                'border-color': '#fff',
                                'border-opacity': 0.8
                            }
                        },
                        {
                            selector: 'node:selected',
                            style: {
                                'border-width': 4,
                                'border-color': '#ffd700',
                                'border-opacity': 1
                            }
                        },
                        {
                            selector: 'node.highlighted',
                            style: {
                                'border-width': 4,
                                'border-color': '#ff4757',
                                'border-opacity': 1,
                                'background-color': '#ff4757'
                            }
                        },
                        {
                            selector: 'edge',
                            style: {
                                'width': 2,
                                'line-color': '#95a5a6',
                                'target-arrow-color': '#95a5a6',
                                'target-arrow-shape': 'triangle',
                                'curve-style': 'bezier',
                                'label': 'data(label)',
                                'font-size': '10px',
                                'text-rotation': 'autorotate',
                                'text-margin-y': -10,
                                'color': '#2c3e50',
                                'text-outline-width': 1,
                                'text-outline-color': '#fff'
                            }
                        },
                        {
                            selector: 'edge.highlighted',
                            style: {
                                'width': 4,
                                'line-color': '#ff4757',
                                'target-arrow-color': '#ff4757',
                                'opacity': 1
                            }
                        }
                    ],
                    layout: {
                        name: 'cose',
                        animate: true,
                        animationDuration: 1000,
                        fit: true,
                        padding: 30
                    }
                });

                // Eventos de interacci√≥n
                cy.on('tap', 'node', function(evt) {
                    const node = evt.target;
                    const nodeId = node.data('id');
                    showNodeInfo(nodeId);
                });

                cy.on('tap', function(evt) {
                    if (evt.target === cy) {
                        clearHighlights();
                    }
                });

                console.log('Cytoscape inicializado correctamente');
            } catch (error) {
                console.error('Error inicializando Cytoscape:', error);
                showMessage('Error inicializando la visualizaci√≥n: ' + error.message, 'error');
            }
        }

        // Cargar datos del grafo
        async function loadGraph() {
            try {
                if (!cy) {
                    throw new Error('Cytoscape no est√° inicializado');
                }
                
                document.getElementById('graph-status').textContent = 'Cargando...';
                
                const response = await fetch('/graph/cytoscape-data');
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status} - ${response.statusText}`);
                }
                
                graphData = await response.json();
                
                if (!graphData || !graphData.nodes || !graphData.edges) {
                    throw new Error('Datos del grafo inv√°lidos');
                }
                
                // Limpiar el grafo actual
                cy.elements().remove();
                
                // Agregar nuevos elementos
                cy.add(graphData);
                
                // Aplicar layout
                applyLayout();
                
                // Actualizar informaci√≥n
                updateGraphInfo();
                
                document.getElementById('graph-status').textContent = 'Cargado';
                showMessage(`Grafo cargado exitosamente: ${graphData.nodes.length} nodos, ${graphData.edges.length} aristas`, 'success');
                
            } catch (error) {
                console.error('Error cargando el grafo:', error);
                document.getElementById('graph-status').textContent = 'Error';
                showMessage(`Error cargando el grafo: ${error.message}`, 'error');
            }
        }

        // Aplicar layout seleccionado
        function applyLayout() {
            if (!cy) {
                console.error('Cytoscape no est√° inicializado');
                return;
            }
            
            const layoutName = document.getElementById('layout-select').value;
            
            try {
                const layoutOptions = {
                    name: layoutName,
                    animate: true,
                    animationDuration: 1000,
                    fit: true,
                    padding: 30
                };
                
                // Configuraciones espec√≠ficas para cada layout
                switch (layoutName) {
                    case 'cose':
                        layoutOptions.idealEdgeLength = 100;
                        layoutOptions.nodeOverlap = 20;
                        layoutOptions.refresh = 20;
                        layoutOptions.fit = true;
                        layoutOptions.padding = 30;
                        layoutOptions.randomize = false;
                        layoutOptions.componentSpacing = 40;
                        layoutOptions.nodeRepulsion = 400000;
                        layoutOptions.edgeElasticity = 100;
                        layoutOptions.nestingFactor = 5;
                        layoutOptions.gravity = 80;
                        layoutOptions.numIter = 1000;
                        layoutOptions.initialTemp = 200;
                        layoutOptions.coolingFactor = 0.95;
                        layoutOptions.minTemp = 1.0;
                        break;
                    case 'breadthfirst':
                        layoutOptions.directed = true;
                        layoutOptions.roots = '#a';
                        layoutOptions.padding = 30;
                        break;
                    case 'concentric':
                        layoutOptions.concentric = function(node) {
                            return node.degree();
                        };
                        layoutOptions.levelWidth = function(nodes) {
                            return 2;
                        };
                        break;
                }
                
                const layout = cy.layout(layoutOptions);
                layout.run();
                
                console.log(`Layout '${layoutName}' aplicado correctamente`);
            } catch (error) {
                console.error(`Error aplicando layout '${layoutName}':`, error);
                showMessage(`Error aplicando layout: ${error.message}`, 'error');
            }
        }

        // Actualizar informaci√≥n del grafo
        function updateGraphInfo() {
            if (graphData) {
                document.getElementById('node-count').textContent = graphData.nodes.length;
                document.getElementById('edge-count').textContent = graphData.edges.length;
            }
        }

        // Ejecutar DFS
        async function performDFS() {
            const startNode = document.getElementById('start-node').value.trim();
            if (!startNode) {
                showMessage('Por favor ingresa un nodo de inicio', 'error');
                return;
            }

            try {
                const response = await fetch(`/graph/dfs/${encodeURIComponent(startNode)}`);
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const path = await response.json();
                highlightPath(path, 'DFS');
                
            } catch (error) {
                console.error('Error ejecutando DFS:', error);
                showMessage(`Error ejecutando DFS: ${error.message}`, 'error');
            }
        }

        // Ejecutar BFS
        async function performBFS() {
            const startNode = document.getElementById('start-node').value.trim();
            if (!startNode) {
                showMessage('Por favor ingresa un nodo de inicio', 'error');
                return;
            }

            try {
                const response = await fetch(`/graph/bfs/${encodeURIComponent(startNode)}`);
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const path = await response.json();
                highlightPath(path, 'BFS');
                
            } catch (error) {
                console.error('Error ejecutando BFS:', error);
                showMessage(`Error ejecutando BFS: ${error.message}`, 'error');
            }
        }

        // Encontrar camino m√°s corto
        async function findShortestPath() {
            const startNode = document.getElementById('start-node').value.trim();
            const endNode = document.getElementById('end-node').value.trim();
            
            if (!startNode || !endNode) {
                showMessage('Por favor ingresa nodos de inicio y fin', 'error');
                return;
            }

            try {
                const response = await fetch(`/graph/shortest-path/${encodeURIComponent(startNode)}/${encodeURIComponent(endNode)}`);
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const path = await response.json();
                if (path.length === 0) {
                    showMessage('No se encontr√≥ un camino entre los nodos', 'error');
                } else {
                    highlightPath(path, 'Camino m√°s corto');
                }
                
            } catch (error) {
                console.error('Error encontrando camino:', error);
                showMessage(`Error encontrando camino: ${error.message}`, 'error');
            }
        }

        // Resaltar un camino
        function highlightPath(path, algorithm) {
            clearHighlights();
            
            if (path.length === 0) {
                showMessage('No se encontraron nodos en el camino', 'error');
                return;
            }

            // Resaltar nodos
            path.forEach(nodeId => {
                const node = cy.getElementById(nodeId);
                if (node.length > 0) {
                    node.addClass('highlighted');
                    highlightedNodes.add(nodeId);
                }
            });

            // Resaltar aristas entre nodos consecutivos
            for (let i = 0; i < path.length - 1; i++) {
                const source = path[i];
                const target = path[i + 1];
                const edge = cy.edges(`[source="${source}"][target="${target}"], [source="${target}"][target="${source}"]`);
                if (edge.length > 0) {
                    edge.addClass('highlighted');
                    highlightedEdges.add(edge.id());
                }
            }

            // Centrar en el primer nodo
            cy.center(cy.getElementById(path[0]));
            cy.fit(cy.getElementById(path[0]), 100);

            // Mostrar resultados
            showResults(algorithm, path);
        }

        // Limpiar resaltados
        function clearHighlights() {
            cy.elements().removeClass('highlighted');
            highlightedNodes.clear();
            highlightedEdges.clear();
            document.getElementById('results-panel').innerHTML = '';
        }

        // Resetear grafo
        function resetGraph() {
            clearHighlights();
            cy.fit();
            document.getElementById('start-node').value = '';
            document.getElementById('end-node').value = '';
            document.getElementById('results-panel').innerHTML = '';
        }

        // Mostrar informaci√≥n de un nodo
        async function showNodeInfo(nodeId) {
            try {
                const response = await fetch(`/graph/nodes/${encodeURIComponent(nodeId)}/info`);
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const info = await response.json();
                const neighbors = await fetch(`/graph/nodes/${encodeURIComponent(nodeId)}/neighbors`);
                const neighborsList = await neighbors.json();
                
                const infoHtml = `
                    <div class="info-panel">
                        <h3>Informaci√≥n del Nodo</h3>
                        <div class="info-item">
                            <span class="label">ID:</span>
                            <span class="value">${info.id}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Tipo:</span>
                            <span class="value">${info.type}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Vecinos:</span>
                            <span class="value">${info.neighborCount}</span>
                        </div>
                        <div style="margin-top: 10px;">
                            <strong>Vecinos:</strong>
                            <div style="max-height: 100px; overflow-y: auto; font-size: 12px; margin-top: 5px;">
                                ${neighborsList.map(neighbor => `<div>‚Ä¢ ${neighbor}</div>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('results-panel').innerHTML = infoHtml;
                
            } catch (error) {
                console.error('Error obteniendo informaci√≥n del nodo:', error);
            }
        }

        // Mostrar resultados de algoritmos
        function showResults(algorithm, path) {
            const resultsHtml = `
                <div class="info-panel">
                    <h3>Resultados - ${algorithm}</h3>
                    <div class="info-item">
                        <span class="label">Nodos visitados:</span>
                        <span class="value">${path.length}</span>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>Camino:</strong>
                        <div style="max-height: 150px; overflow-y: auto; font-size: 12px; margin-top: 5px;">
                            ${path.map((node, index) => `<div>${index + 1}. ${node}</div>`).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('results-panel').innerHTML = resultsHtml;
        }

        // Mostrar mensajes
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            
            const resultsPanel = document.getElementById('results-panel');
            resultsPanel.insertBefore(messageDiv, resultsPanel.firstChild);
            
            // Remover mensaje despu√©s de 5 segundos
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 5000);
        }

        // Cargar lista de pel√≠culas
        async function loadMovies() {
            try {
                const response = await fetch('/graph/movies');
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const movies = await response.json();
                const movieSelection = document.getElementById('movie-selection');
                
                if (movies.length === 0) {
                    movieSelection.innerHTML = '<div style="text-align: center; color: #666; font-style: italic;">No hay pel√≠culas disponibles</div>';
                    return;
                }
                
                movieSelection.innerHTML = movies.map(movie => `
                    <div class="movie-checkbox">
                        <input type="checkbox" id="movie-${movie.replace(/[^a-zA-Z0-9]/g, '_')}" value="${movie}">
                        <label for="movie-${movie.replace(/[^a-zA-Z0-9]/g, '_')}">${movie}</label>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error cargando pel√≠culas:', error);
                document.getElementById('movie-selection').innerHTML = 
                    '<div style="text-align: center; color: #dc3545; font-style: italic;">Error cargando pel√≠culas</div>';
            }
        }

        // Cargar lista de actores
        async function loadActors() {
            try {
                const response = await fetch('/graph/actors');
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const actors = await response.json();
                const actorSelection = document.getElementById('actor-selection');
                
                if (actors.length === 0) {
                    actorSelection.innerHTML = '<div style="text-align: center; color: #666; font-style: italic;">No hay actores disponibles</div>';
                    return;
                }
                
                actorSelection.innerHTML = actors.map(actor => `
                    <div class="movie-checkbox">
                        <input type="checkbox" id="actor-${actor.replace(/[^a-zA-Z0-9]/g, '_')}" value="${actor}">
                        <label for="actor-${actor.replace(/[^a-zA-Z0-9]/g, '_')}">${actor}</label>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error cargando actores:', error);
                document.getElementById('actor-selection').innerHTML = 
                    '<div style="text-align: center; color: #dc3545; font-style: italic;">Error cargando actores</div>';
            }
        }

        // Agregar nuevo actor
        async function addNewActor() {
            const actorName = document.getElementById('new-actor-name').value.trim();
            const movieCheckboxes = document.querySelectorAll('#movie-selection input[type="checkbox"]:checked');
            
            if (!actorName) {
                showMessage('Por favor ingresa el nombre del actor', 'error');
                return;
            }
            
            if (movieCheckboxes.length === 0) {
                showMessage('Por favor selecciona al menos una pel√≠cula', 'error');
                return;
            }
            
            const selectedMovies = Array.from(movieCheckboxes).map(cb => cb.value);
            
            try {
                const response = await fetch('/graph/add-actor', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        actorName: actorName,
                        movieTitles: selectedMovies
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(result.message, 'success');
                    
                    // Limpiar formulario
                    document.getElementById('new-actor-name').value = '';
                    document.querySelectorAll('#movie-selection input[type="checkbox"]').forEach(cb => cb.checked = false);
                    
                    // Recargar el grafo y las listas para mostrar los cambios
                    setTimeout(() => {
                        loadGraph();
                        loadActors();
                    }, 1000);
                    
                } else {
                    showMessage(result.message, 'error');
                }
                
            } catch (error) {
                console.error('Error agregando actor:', error);
                showMessage(`Error agregando actor: ${error.message}`, 'error');
            }
        }

        // Agregar nueva pel√≠cula
        async function addNewMovie() {
            const movieTitle = document.getElementById('new-movie-title').value.trim();
            const actorCheckboxes = document.querySelectorAll('#actor-selection input[type="checkbox"]:checked');
            const directorCheckboxes = document.querySelectorAll('#director-selection input[type="checkbox"]:checked');
            
            if (!movieTitle) {
                showMessage('Por favor ingresa el t√≠tulo de la pel√≠cula', 'error');
                return;
            }
            
            if (actorCheckboxes.length === 0 && directorCheckboxes.length === 0) {
                showMessage('Por favor selecciona al menos un actor o director', 'error');
                return;
            }
            
            const selectedActors = Array.from(actorCheckboxes).map(cb => cb.value);
            const selectedDirectors = Array.from(directorCheckboxes).map(cb => cb.value);
            
            try {
                const response = await fetch('/graph/add-movie', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        movieTitle: movieTitle,
                        actorNames: selectedActors,
                        directorNames: selectedDirectors
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(result.message, 'success');
                    
                    // Limpiar formulario
                    document.getElementById('new-movie-title').value = '';
                    document.querySelectorAll('#actor-selection input[type="checkbox"]').forEach(cb => cb.checked = false);
                    document.querySelectorAll('#director-selection input[type="checkbox"]').forEach(cb => cb.checked = false);
                    
                    // Recargar el grafo y las listas para mostrar los cambios
                    setTimeout(() => {
                        loadGraph();
                        loadMovies();
                    }, 1000);
                    
                } else {
                    showMessage(result.message, 'error');
                }
                
            } catch (error) {
                console.error('Error agregando pel√≠cula:', error);
                showMessage(`Error agregando pel√≠cula: ${error.message}`, 'error');
            }
        }

        // Event listeners
        document.getElementById('layout-select').addEventListener('change', applyLayout);

        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Iniciando aplicaci√≥n...');
            
            // Esperar un poco para asegurar que todos los scripts est√©n cargados
            setTimeout(() => {
                try {
                    initCytoscape();
                    
                    // Cargar el grafo y las listas despu√©s de un peque√±o delay
                    setTimeout(() => {
                        loadGraph();
                        loadMovies();
                        loadActors();
                    }, 500);
                    
                } catch (error) {
                    console.error('Error en la inicializaci√≥n:', error);
                    showMessage('Error inicializando la aplicaci√≥n: ' + error.message, 'error');
                }
            }, 100);
        });
    </script>
</body>
</html>
